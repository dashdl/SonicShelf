<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhongxin.sonicshelf.mapper.CommentMapper">
    <update id="batchDeleteCommentById">
        update comments
        set status = 0
        where id in
        <foreach collection="ids" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </update>

    <select id="selectComment" resultType="com.zhongxin.sonicshelf.dto.response.CommentManageResponse">
        select c.id,
        c.content,
        u.nickname,
        u.avatar,
        c.target_type,
        c.parent_id,
        c.like_count,
        c.reply_count,
        c.status,
        c.created_at
        from comments as c
        left join users as u on c.user_id = u.id
        <where>
            <if test="targetType != null and targetType != ''">
                c.target_type = #{targetType}
            </if>
            <if test="keyword != null and keyword != ''">
                and c.content like concat('%', #{keyword}, '%')
            </if>
            <if test="startDate != null and startDate != ''">
                AND DATE(c.created_at) &gt;= #{startDate}
            </if>
            <if test="endDate != null and endDate != ''">
                AND DATE(c.created_at) &lt;= #{endDate}
            </if>
        </where>
    </select>
    <select id="selectCommentManageResponseById" resultType="com.zhongxin.sonicshelf.dto.response.CommentManageResponse">
        select c.id,
               c.content,
               u.nickname,
               u.avatar,
               c.target_type,
               c.parent_id,
               c.like_count,
               c.reply_count,
               c.status,
               c.created_at
        from comments as c
                 left join users as u on c.user_id = u.id
        where c.id = #{id}
    </select>
</mapper>